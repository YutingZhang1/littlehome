<view class="container">
  <!-- åˆ é™¤è‡ªå®šä¹‰å¯¼èˆªæ ï¼Œç›´æ¥æ˜¾ç¤ºé¡µé¢å†…å®¹ -->

  <!-- æƒ…ä¾£ç»‘å®šå±•ç¤ºå’Œå…¥å£ -->
  <view class="couple-bind-container" bindtap="showCoupleBindModal">
    <view wx:if="{{isBinded}}">
      <image class="couple-avatar" src="{{partner.avatar}}" mode="aspectFill"/>
      <text class="couple-nickname">å·²ç»‘å®šï¼š{{partner.nickname}}</text>
    </view>
    <view wx:else>
      <text class="couple-unbind">æœªç»‘å®šæƒ…ä¾£ï¼Œç‚¹å‡»ç»‘å®š</text>
    </view>
  </view>

  <!-- æƒ…ä¾£ç»‘å®šå¼¹çª— -->
  <view wx:if="{{showCoupleBindModal}}" class="couple-bind-modal">
    <view class="modal-mask" bindtap="hideCoupleBindModal"></view>
    <view class="modal-content">
      <view class="modal-title">æƒ…ä¾£ç»‘å®š</view>
      <view wx:if="{{isBinded}}" class="modal-bind-status">
        <view class="couple-pair">
          <image class="couple-avatar left" src="{{partner.avatar}}" mode="aspectFill"/>
          <view class="chain-connector"></view>
          <image class="couple-avatar right" src="{{userInfo.avatarUrl}}" mode="aspectFill"/>
        </view>
        <view class="couple-names">
          <text class="couple-name left">{{partner.nickname}}</text>
          <text class="couple-name right">{{userInfo.nickName}}</text>
        </view>
        <text>å·²ç»‘å®šæƒ…ä¾£å…³ç³»</text>
        <button class="unbind-btn" bindtap="showUnbindConfirm">è§£ç»‘</button>
      </view>
      <view wx:else>
        <view wx:if="{{bindCode}}" class="bind-code-section">
          <text class="bind-code-label">ä½ çš„ç»‘å®šç ï¼š</text>
          <view class="bind-code-container" bindtap="copyBindCode">
            <text class="bind-code-text">{{bindCode}}</text>
            <text class="copy-icon">ğŸ“‹</text>
          </view>
        </view>
        <view class="bind-input-section">
          <text class="bind-input-label">è¾“å…¥å¯¹æ–¹ç»‘å®šç ï¼š</text>
          <input class="bind-input" placeholder="è¯·è¾“å…¥å¯¹æ–¹çš„ç»‘å®šç " value="{{inputBindCode}}" bindinput="onInputBindCode"/>
        </view>
        <button class="pretty-gradient-btn" bindtap="bindWithCode">ç»‘å®š</button>
      </view>
      <button class="pretty-gradient-btn" bindtap="hideCoupleBindModal">å…³é—­</button>
    </view>
  </view>

  <!-- è§£ç»‘ç¡®è®¤å¼¹çª— -->
  <view wx:if="{{showUnbindConfirm}}" class="unbind-confirm-modal">
    <view class="modal-mask" bindtap="hideUnbindConfirm"></view>
    <view class="modal-content">
      <view class="modal-title">âš ï¸ è§£ç»‘ç¡®è®¤</view>
      <view class="unbind-warning">
        <text class="warning-text">ç¡®å®šè¦è§£é™¤ä¸ {{partner.nickname}} çš„æƒ…ä¾£ç»‘å®šå—ï¼Ÿ</text>
        <text class="warning-desc">è§£ç»‘åå°†æ— æ³•æŸ¥çœ‹å¯¹æ–¹çš„åŠ¨æ€å’ŒçŠ¶æ€</text>
      </view>
      <view class="unbind-buttons">
        <button class="cancel-btn" style="width: 200rpx;" bindtap="hideUnbindConfirm">å–æ¶ˆ</button>
        <button class="confirm-unbind-btn" style="width: 200rpx;"  bindtap="confirmUnbind">ç¡®è®¤è§£ç»‘</button>
      </view>
    </view>
  </view>

  <!-- è®¡æ—¶å™¨ -->
  <view class="timer-container" bindtap="showAnniversaryPicker">
    <text class="timer-text">{{currentAnniversary.title}}</text>
    <text class="timer-days">{{days}}å¤©</text>
    <text class="timer-detail">{{hours}}æ—¶{{minutes}}åˆ†{{seconds}}ç§’</text>
    <text class="timer-date">{{currentAnniversary.date}}</text>
  </view>

  <!-- çºªå¿µæ—¥é€‰æ‹©å¼¹çª— -->
  <view wx:if="{{showAnniversaryPicker}}" class="anniversary-picker-modal">
    <view class="modal-mask" bindtap="hideAnniversaryPicker"></view>
    <view class="modal-content">
      <view class="modal-title">é€‰æ‹©çºªå¿µæ—¥</view>
      <view class="anniversary-list">
        <view class="anniversary-item" wx:for="{{anniversaries}}" wx:key="id" bindtap="selectAnniversary" data-id="{{item.id}}">
          <text>{{item.title}}ï¼š{{item.date}}</text>
        </view>
      </view>
      <button class="pretty-gradient-btn" bindtap="hideAnniversaryPicker">å…³é—­</button>
    </view>
  </view>

  <!-- èƒŒæ™¯å®¹å™¨ -->
  <view class="garden-container">
    <image class="background" src="https://littlehome-1301530190.cos.ap-nanjing.myqcloud.com/pic/bg2.jpg" mode="aspectFill"/>
  </view>

  <!-- å°å®¶å®¶å…·å’Œæ•ˆæœ -->
  <view class="home-image-wrapper">
    <!-- ç©ºè°ƒ -->
    <view class="furniture aircondition" bindtap="onAirConditionTap">
      <image src="https://littlehome-1301530190.cos.ap-nanjing.myqcloud.com/pic/aircondition.png" mode="aspectFit"/>
    </view>
    <canvas canvas-id="airEffectCanvas" class="effect-canvas air-effect-canvas" wx:if="{{showAirEffect}}"></canvas>
    
    <!-- å†°ç®± -->
    <view class="furniture fridge" bindtap="onFridgeTap">
      <image src="https://littlehome-1301530190.cos.ap-nanjing.myqcloud.com/pic/bingxiang.png" mode="aspectFit"/>
    </view>
    <canvas canvas-id="fridgeEffectCanvas" class="effect-canvas fridge-effect-canvas" wx:if="{{showFridgeEffect}}"></canvas>
    
    <!-- é£æ‰‡ -->
    <view class="furniture fan" bindtap="onFanTap">
      <image src="https://littlehome-1301530190.cos.ap-nanjing.myqcloud.com/pic/fengshan.png" mode="aspectFit"/>
    </view>
    <canvas canvas-id="fanEffectCanvas" class="effect-canvas fan-effect-canvas" wx:if="{{showFanEffect}}"></canvas>
    
    <!-- æ²™å‘ -->
    <view class="furniture sofa" bindtap="onSofaTap">
      <image src="https://littlehome-1301530190.cos.ap-nanjing.myqcloud.com/pic/sofa1.png" mode="aspectFit"/>
    </view>
    <canvas canvas-id="sofaEffectCanvas" class="effect-canvas sofa-effect-canvas" wx:if="{{showSofaEffect}}"></canvas>
  </view>

  <!-- è§’è‰²å…ƒç´  -->
  <image class="character" src="{{characterImage}}" bindtap="onCharacterTap" data-action="{{currentAction}}" style="opacity: {{characterOpacity}};"/>
  
  <!-- åŠ¨ä½œé€‰æ‹©æ¡† -->
  <view class="action-selector">
    <view class="action-selector-header">
      <text class="action-selector-title">ğŸ­ åŠ¨ä½œ</text>
    </view>
    <scroll-view class="action-list" scroll-x="true" enhanced="true" show-scrollbar="false">
      <view class="action-item {{currentAction === action ? 'active' : ''}}" 
            wx:for="{{actions}}" 
            wx:key="*this" 
            wx:for-item="action"
            bindtap="selectAction"
            data-action="{{action}}">
        <view class="action-icon">{{actionIcons[action]}}</view>
        <text class="action-name">{{actionNames[action]}}</text>
      </view>
    </scroll-view>
  </view>

  <!-- èŠå¤©åŠŸèƒ½ -->
  <view class="chat-container" wx:if="{{showChat}}">
    <view class="chat-content">
      <!-- èŠå¤©æ°”æ³¡ -->
      <view class="chat-bubbles">
        <view class="chat-bubble" wx:for="{{chatMessages}}" wx:key="index" wx:if="{{index < 2}}">
          <view class="bubble-content {{item.type === 'user' ? 'user-bubble' : 'character-bubble'}}">
            <text class="bubble-text">{{item.content}}</text>
          </view>
          <view class="bubble-tail {{item.type === 'user' ? 'user-tail' : 'character-tail'}}"></view>
        </view>
      </view>
      
      <!-- è¾“å…¥æ¡† -->
      <view class="chat-input-container">
        <input class="chat-input" 
               placeholder="å’Œè§’è‰²èŠå¤©..." 
               value="{{chatInputText}}"
               bindinput="onChatInput"
               bindconfirm="sendChatMessage"
               confirm-type="send"/>
        <button class="send-btn" bindtap="sendChatMessage">å‘é€</button>
      </view>
      
      <!-- å…³é—­èŠå¤©æŒ‰é’® -->
      <button class="close-chat-btn" style="width: 20rpx;" bindtap="closeChat">âœ•</button>
    </view>
  </view>

  <!-- èŠå¤©æŒ‰é’® -->
  <view class="chat-trigger" bindtap="openChat" wx:if="{{!showChat}}">
    <text class="chat-trigger-text">ğŸ’¬</text>
  </view>

  <!-- æƒ…æ„Ÿå¤ç›˜æŠ¥å‘Šå¼¹çª— -->
  <view wx:if="{{showEmotionReport}}" class="emotion-report-modal">
    <view class="modal-mask" bindtap="hideEmotionReport"></view>
    <view class="modal-content emotion-report-content">
      <view class="modal-header">
        <text class="modal-title">ğŸ’ æƒ…æ„Ÿå¤ç›˜æŠ¥å‘Š</text>
        <button class="modal-close" bindtap="hideEmotionReport">Ã—</button>
      </view>
      <scroll-view class="report-body" scroll-y="true">
        <view class="report-section">
          <text class="section-title">ğŸ“Š æƒ…æ„ŸçŠ¶æ€åˆ†æ</text>
          <view class="emotion-analysis">
            <text class="analysis-text">{{emotionReport.analysis}}</text>
          </view>
        </view>
        
        <view class="report-section">
          <text class="section-title">ğŸ’¡ æƒ…æ„Ÿå»ºè®®</text>
          <view class="emotion-suggestions">
            <view class="suggestion-item" wx:for="{{emotionReport.suggestions}}" wx:key="*this">
              <text class="suggestion-text">â€¢ {{item}}</text>
            </view>
          </view>
        </view>
        
        <view class="report-section">
          <text class="section-title">ğŸ¯ å…³æ³¨é‡ç‚¹</text>
          <view class="focus-points">
            <view class="focus-item" wx:for="{{emotionReport.focusPoints}}" wx:key="*this">
              <text class="focus-text">ğŸ”¸ {{item}}</text>
            </view>
          </view>
        </view>
        
        <view class="report-section">
          <text class="section-title">ğŸ“ˆ æƒ…æ„Ÿè¶‹åŠ¿</text>
          <view class="emotion-trend">
            <text class="trend-text">{{emotionReport.trend}}</text>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- åˆ†äº«Canvasï¼ˆéšè—ï¼‰ -->
  <canvas canvas-id="shareCanvas" style="position: fixed; top: -1000px; left: -1000px; width: 300px; height: 400px;"></canvas>
</view>
