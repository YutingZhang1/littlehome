<!--pages/souvenirs/souvenirs.wxml-->
<view class="container">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <view class="custom-navbar">
    <view class="navbar-left" bindtap="goBack">
      <text class="back-icon">â†</text>
      <text class="back-text">è¿”å›</text>
    </view>
    <text class="navbar-title">çºªå¿µå“</text>
    <view class="navbar-right"></view>
  </view>

  <!-- é¡¶éƒ¨æ¨ªå¹… -->
  <view class="banner-section">
    <view class="banner-content">
      <text class="banner-title">å®šåˆ¶åŒ–æƒ…ä¾£çºªå¿µå“</text>
      <text class="banner-subtitle">å°†"LittleHome"ä¸­è®°å½•çš„æ—¥å¸¸ä¸äº‹ä»¶ï¼Œè½¬åŒ–ä¸ºç‹¬ä¸€æ— äºŒçš„å®ä½“çºªå¿µå“</text>
    </view>
    <view class="banner-decoration">
      <text class="decoration-icon">ğŸ</text>
    </view>
  </view>

  <!-- çºªå¿µå“åˆ†ç±» -->
  <view class="category-tabs">
    <view class="tab-item {{currentCategory === 'all' ? 'active' : ''}}" 
          bindtap="switchCategory" data-category="all">
      <text class="tab-text">å…¨éƒ¨</text>
    </view>
    <view class="tab-item {{currentCategory === 'book' ? 'active' : ''}}" 
          bindtap="switchCategory" data-category="book">
      <text class="tab-text">å›å¿†å½•</text>
    </view>
    <view class="tab-item {{currentCategory === 'album' ? 'active' : ''}}" 
          bindtap="switchCategory" data-category="album">
      <text class="tab-text">ç›¸å†Œ</text>
    </view>
    <view class="tab-item {{currentCategory === 'sculpture' ? 'active' : ''}}" 
          bindtap="switchCategory" data-category="sculpture">
      <text class="tab-text">é›•åƒ</text>
    </view>
  </view>

  <!-- çºªå¿µå“åˆ—è¡¨ -->
  <view class="souvenirs-list">
    <view class="souvenir-item" wx:for="{{filteredSouvenirs}}" wx:key="id" 
          bindtap="viewSouvenirDetail" data-id="{{item.id}}">
      <view class="souvenir-image">
        <image src="{{item.image}}" mode="aspectFill" class="item-image"></image>
        <view class="souvenir-badge" wx:if="{{item.isNew}}">
          <text class="badge-text">æ–°å“</text>
        </view>
        <view class="souvenir-badge hot" wx:if="{{item.isHot}}">
          <text class="badge-text">çƒ­é—¨</text>
        </view>
      </view>
      
      <view class="souvenir-info">
        <text class="souvenir-name">{{item.name}}</text>
        <text class="souvenir-desc">{{item.description}}</text>
        <view class="souvenir-meta">
          <view class="points-section">
            <image class="points-icon" src="https://dis-1301530190.cos.ap-nanjing.myqcloud.com/LittlehomePic/rice/heart.png" mode="aspectFit"></image>
            <text class="points-value">{{item.points}}</text>
            <text class="points-original" wx:if="{{item.originalPoints}}">{{item.originalPoints}}</text>
          </view>
          <view class="rating-section">
            <text class="rating-stars">â­â­â­â­â­</text>
            <text class="rating-count">({{item.ratingCount}})</text>
          </view>
        </view>
        
        <view class="souvenir-tags">
          <text class="tag" wx:for="{{item.tags}}" wx:key="*this" wx:for-item="tag">{{tag}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{filteredSouvenirs.length === 0}}">
    <text class="empty-icon">ğŸ</text>
    <text class="empty-title">æš‚æ— ç›¸å…³çºªå¿µå“</text>
    <text class="empty-desc">æˆ‘ä»¬æ­£åœ¨ä¸ºæ‚¨å‡†å¤‡æ›´å¤šç²¾ç¾çš„å®šåˆ¶çºªå¿µå“</text>
  </view>

  <!-- çºªå¿µå“è¯¦æƒ…å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showDetailModal}}" bindtap="hideDetailModal">
    <view class="modal-content detail-modal" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">{{selectedSouvenir.name}}</text>
        <button class="modal-close" bindtap="hideDetailModal">Ã—</button>
      </view>

      <scroll-view class="modal-body" scroll-y="true">
        <!-- å•†å“å›¾ç‰‡è½®æ’­ -->
        <swiper class="detail-swiper" indicator-dots="true" autoplay="true" interval="3000">
          <swiper-item wx:for="{{selectedSouvenir.images}}" wx:key="*this">
            <image src="{{item}}" mode="aspectFill" class="swiper-image"></image>
          </swiper-item>
        </swiper>

        <!-- å•†å“ä¿¡æ¯ -->
        <view class="detail-info">
          <view class="detail-points">
            <image class="detail-points-icon" src="https://dis-1301530190.cos.ap-nanjing.myqcloud.com/LittlehomePic/rice/heart.png" mode="aspectFit"></image>
            <text class="detail-points-value">{{selectedSouvenir.points}}</text>
            <text class="detail-points-original" wx:if="{{selectedSouvenir.originalPoints}}">{{selectedSouvenir.originalPoints}}</text>
          </view>
          
          <view class="detail-rating">
            <text class="detail-stars">â­â­â­â­â­</text>
            <text class="detail-rating-text">{{selectedSouvenir.rating}} ({{selectedSouvenir.ratingCount}}æ¡è¯„ä»·)</text>
          </view>

          <text class="detail-description">{{selectedSouvenir.fullDescription}}</text>
        </view>

        <!-- å®šåˆ¶é€‰é¡¹ -->
        <view class="customization-section">
          <text class="section-title">å®šåˆ¶é€‰é¡¹</text>
          
          <!-- æ¨¡æ¿é€‰æ‹© -->
          <view class="option-group" wx:if="{{selectedSouvenir.templates}}">
            <text class="option-label">é€‰æ‹©æ¨¡æ¿</text>
            <view class="template-grid">
              <view class="template-item {{selectedTemplate === item.id ? 'selected' : ''}}" 
                    wx:for="{{selectedSouvenir.templates}}" wx:key="id" wx:for-item="item"
                    bindtap="selectTemplate" data-id="{{item.id}}">
                <image src="{{item.preview}}" mode="aspectFill" class="template-preview"></image>
                <text class="template-name">{{item.name}}</text>
              </view>
            </view>
          </view>

          <!-- é£æ ¼é€‰æ‹© -->
          <view class="option-group" wx:if="{{selectedSouvenir.styles}}">
            <text class="option-label">é€‰æ‹©é£æ ¼</text>
            <view class="style-grid">
              <view class="style-item {{selectedStyle === item.id ? 'selected' : ''}}" 
                    wx:for="{{selectedSouvenir.styles}}" wx:key="id" wx:for-item="item"
                    bindtap="selectStyle" data-id="{{item.id}}">
                <text class="style-icon">{{item.icon}}</text>
                <text class="style-name">{{item.name}}</text>
              </view>
            </view>
          </view>

          <!-- å°ºå¯¸é€‰æ‹© -->
          <view class="option-group" wx:if="{{selectedSouvenir.sizes}}">
            <text class="option-label">é€‰æ‹©å°ºå¯¸</text>
            <view class="size-grid">
              <view class="size-item {{selectedSize === item.id ? 'selected' : ''}}" 
                    wx:for="{{selectedSouvenir.sizes}}" wx:key="id" wx:for-item="item"
                    bindtap="selectSize" data-id="{{item.id}}">
                <text class="size-name">{{item.name}}</text>
                <text class="size-desc">{{item.description}}</text>
                <text class="size-points" wx:if="{{item.pointsAdjustment > 0}}">+{{item.pointsAdjustment}}</text>
              </view>
            </view>
          </view>

          <!-- æ•°é‡é€‰æ‹© -->
          <view class="option-group">
            <text class="option-label">æ•°é‡</text>
            <view class="quantity-selector">
              <button class="quantity-btn" bindtap="decreaseQuantity" disabled="{{quantity <= 1}}">-</button>
              <text class="quantity-value">{{quantity}}</text>
              <button class="quantity-btn" bindtap="increaseQuantity">+</button>
            </view>
          </view>
        </view>

        <!-- ç”¨æˆ·è¯„ä»· -->
        <view class="reviews-section" wx:if="{{selectedSouvenir.reviews}}">
          <text class="section-title">ç”¨æˆ·è¯„ä»·</text>
          <view class="review-item" wx:for="{{selectedSouvenir.reviews}}" wx:key="id" wx:for-item="review">
            <view class="review-header">
              <image src="{{review.avatar}}" class="review-avatar"></image>
              <view class="review-info">
                <text class="review-name">{{review.name}}</text>
                <text class="review-stars">â­â­â­â­â­</text>
              </view>
              <text class="review-date">{{review.date}}</text>
            </view>
            <text class="review-content">{{review.content}}</text>
            <view class="review-images" wx:if="{{review.images}}">
              <image wx:for="{{review.images}}" wx:key="*this" wx:for-item="img" 
                     src="{{img}}" mode="aspectFill" class="review-image"></image>
            </view>
          </view>
        </view>
      </scroll-view>

      <view class="modal-footer">
        <view class="total-points">
          <text class="total-label">æ€»è®¡ï¼š</text>
          <image class="total-points-icon" src="https://dis-1301530190.cos.ap-nanjing.myqcloud.com/LittlehomePic/rice/heart.png" mode="aspectFit"></image>
          <text class="total-value">{{totalPoints}}</text>
        </view>
        <view class="action-buttons">
          <button class="btn btn-outline" bindtap="addToCart">åŠ å…¥è´­ç‰©è½¦</button>
          <button class="btn btn-primary" bindtap="buyNow">ç«‹å³è´­ä¹°</button>
        </view>
      </view>
    </view>
  </view>

  <!-- è´­ç‰©è½¦å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showCartModal}}" bindtap="hideCartModal">
    <view class="modal-content cart-modal" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">è´­ç‰©è½¦</text>
        <button class="modal-close" bindtap="hideCartModal">Ã—</button>
      </view>

      <scroll-view class="modal-body" scroll-y="true">
        <view class="cart-items" wx:if="{{cartItems.length > 0}}">
          <view class="cart-item" wx:for="{{cartItems}}" wx:key="id" wx:for-item="item">
            <image src="{{item.image}}" class="cart-item-image"></image>
            <view class="cart-item-info">
              <text class="cart-item-name">{{item.name}}</text>
              <text class="cart-item-options">{{item.options}}</text>
              <view class="cart-item-points">
                <image class="cart-points-icon" src="https://dis-1301530190.cos.ap-nanjing.myqcloud.com/LittlehomePic/rice/heart.png" mode="aspectFit"></image>
                <text class="cart-points-value">{{item.points}}</text>
              </view>
            </view>
            <view class="cart-item-actions">
              <button class="cart-quantity-btn" bindtap="decreaseCartQuantity" data-id="{{item.id}}">-</button>
              <text class="cart-quantity">{{item.quantity}}</text>
              <button class="cart-quantity-btn" bindtap="increaseCartQuantity" data-id="{{item.id}}">+</button>
              <button class="cart-remove-btn" bindtap="removeFromCart" data-id="{{item.id}}">åˆ é™¤</button>
            </view>
          </view>
        </view>
        
        <view class="empty-cart" wx:else>
          <text class="empty-cart-icon">ğŸ›’</text>
          <text class="empty-cart-text">è´­ç‰©è½¦æ˜¯ç©ºçš„</text>
        </view>
      </scroll-view>

      <view class="modal-footer" wx:if="{{cartItems.length > 0}}">
        <view class="cart-total">
          <text class="cart-total-label">æ€»è®¡ï¼š</text>
          <image class="cart-total-icon" src="https://dis-1301530190.cos.ap-nanjing.myqcloud.com/LittlehomePic/rice/heart.png" mode="aspectFit"></image>
          <text class="cart-total-value">{{cartTotal}}</text>
        </view>
        <button class="btn btn-primary" bindtap="checkout">å»ç»“ç®—</button>
      </view>
    </view>
  </view>

  <!-- æµ®åŠ¨è´­ç‰©è½¦æŒ‰é’® -->
  <view class="fab-cart" bindtap="showCartModal">
    <text class="fab-cart-icon">ğŸ›’</text>
    <view class="fab-cart-badge" wx:if="{{cartItemCount > 0}}">
      <text class="fab-cart-count">{{cartItemCount}}</text>
    </view>
  </view>

  <!-- åˆ†äº«Canvasï¼ˆéšè—ï¼‰ -->
  <canvas canvas-id="shareCanvas" style="position: fixed; top: -1000px; left: -1000px; width: 300px; height: 400px;"></canvas>
</view> 