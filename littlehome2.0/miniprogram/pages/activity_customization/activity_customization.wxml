<view class="custom-navbar">
  <text class="navbar-title">LittleHome</text>
</view>

<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header">
    <view class="header-content">
      <text class="header-title">å®šåˆ¶åŒ–ç¤¼ç‰©ä¸æ´»åŠ¨å»ºè®®</text>
      <text class="header-subtitle">AIæ™ºèƒ½æ¨èï¼Œä¸ºä½ ä»¬çš„çˆ±æƒ…é‡èº«å®šåˆ¶</text>
    </view>
  </view>

  <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
  <view class="tab-container">
    <view class="tab-item {{currentTab === 'gift' ? 'active' : ''}}" bindtap="switchTab" data-tab="gift">
      <text class="tab-icon">ğŸ</text>
      <text class="tab-text">ç¤¼ç‰©å»ºè®®</text>
    </view>
    <view class="tab-item {{currentTab === 'activity' ? 'active' : ''}}" bindtap="switchTab" data-tab="activity">
      <text class="tab-icon">ğŸ¯</text>
      <text class="tab-text">æ´»åŠ¨å»ºè®®</text>
    </view>
  </view>

  <!-- å¤©æ°”ä¿¡æ¯ -->
  <view class="weather-info" wx:if="{{weatherData.userLocation || weatherData.partnerLocation}}">
    <view class="weather-item">
      <text class="weather-location">{{weatherData.userLocation || 'æˆ‘çš„åŸå¸‚'}}</text>
      <text class="weather-icon">{{weatherData.userWeather.icon || 'ğŸŒ¤ï¸'}}</text>
      <text class="weather-temp">{{weatherData.userWeather.temperature || '--'}}Â°C</text>
    </view>
    <view class="weather-divider">ğŸ’•</view>
    <view class="weather-item">
      <text class="weather-location">{{weatherData.partnerLocation || 'ä¼´ä¾£åŸå¸‚'}}</text>
      <text class="weather-icon">{{weatherData.partnerWeather.icon || 'ğŸŒ¤ï¸'}}</text>
      <text class="weather-temp">{{weatherData.partnerWeather.temperature || '--'}}Â°C</text>
    </view>
  </view>

  <!-- æç¤ºè®¾ç½®åŸå¸‚ä¿¡æ¯ -->
  <view class="weather-tip" wx:if="{{!weatherData.userLocation && !weatherData.partnerLocation}}">
    <text class="tip-text">ğŸ’¡ è®¾ç½®ç”¨æˆ·ç”»åƒä¸­çš„åŸå¸‚ä¿¡æ¯ï¼ŒæŸ¥çœ‹ä¸¤åœ°å¤©æ°”</text>
  </view>

  <!-- ç¤¼ç‰©å»ºè®®é¡µé¢ -->
  <view class="content-section" wx:if="{{currentTab === 'gift'}}">
    <!-- ç”¨æˆ·ç”»åƒè®¾ç½® -->
    <view class="profile-section">
      <view class="section-header">
        <text class="section-title">ç”¨æˆ·ç”»åƒ</text>
        <text class="section-subtitle">å®Œå–„ä¿¡æ¯è·å¾—æ›´ç²¾å‡†çš„æ¨è</text>
      </view>
      <button class="profile-btn" bindtap="showProfileForm">
        <text class="btn-icon">ğŸ¨</text>
        <text class="btn-text">è®¾ç½®ç”¨æˆ·ç”»åƒ</text>
      </button>
    </view>

    <!-- ç²¾å“å•†åŸ -->
    <!-- <view class="mall-section">
      <view class="section-header">
        <text class="section-title">ç²¾å“å•†åŸ</text>
        <text class="section-subtitle">å“è´¨ä¿è¯ï¼Œä¸€ç«™è´­ä¹°</text>
      </view>
      
      <view class="mall-grid">
        <view class="mall-item" wx:for="{{mallProducts}}" wx:key="id" bindtap="selectProduct" data-id="{{item.id}}">
          <image class="mall-image" src="{{item.image}}" mode="aspectFill"></image>
          <view class="mall-info">
            <text class="mall-name">{{item.name}}</text>
            <view class="mall-tags">
              <text class="mall-tag" wx:for="{{item.tags}}" wx:key="*this">{{item}}</text>
            </view>
            <view class="mall-price">
              <view class="mall-points-display">
                <image class="mall-points-icon" src="https://dis-1301530190.cos.ap-nanjing.myqcloud.com/LittlehomePic/rice/heart.png" mode="aspectFit"></image>
                <text class="mall-current-points">{{item.points}}</text>
              </view>
              <text class="mall-original-points" wx:if="{{item.originalPoints}}">{{item.originalPoints}}</text>
            </view>
            <text class="mall-stock">åº“å­˜: {{item.stock}}</text>
          </view>
        </view>
      </view>
    </view> -->

    <!-- AIä¸ªæ€§åŒ–æ¨è -->
    <view class="ai-recommendation-section">
      <view class="section-header">
        <text class="section-title">AIä¸ªæ€§åŒ–æ¨è</text>
        <text class="section-subtitle">åŸºäºä½ ä»¬çš„å–œå¥½æ™ºèƒ½æ¨èä¸“å±ç¤¼ç‰©</text>
      </view>
      <button class="generate-btn" bindtap="showGiftForm">
        <text class="btn-icon">ğŸ¯</text>
        <text class="btn-text">å¼€å§‹AIæ¨è</text>
      </button>
    </view>
  </view>

  <!-- æ´»åŠ¨å»ºè®®é¡µé¢ -->
  <view class="content-section" wx:if="{{currentTab === 'activity'}}">
    <!-- æ”»ç•¥å¹³å° -->
    <view class="guide-section">
      <view class="section-header">
        <text class="section-title">æƒ…ä¾£æ”»ç•¥å¹³å°</text>
        <text class="section-subtitle">ç²¾é€‰æ”»ç•¥ï¼Œè®©çº¦ä¼šæ›´ç²¾å½©</text>
      </view>
      
      <view class="guide-list">
        <view class="guide-item" wx:for="{{guides}}" wx:key="id" bindtap="viewGuide" data-id="{{item.id}}">
          <image class="guide-image" src="{{item.image}}" mode="aspectFill"></image>
          <view class="guide-info">
            <view class="guide-header">
              <text class="guide-title">{{item.title}}</text>
              <text class="guide-category">{{item.category}}</text>
            </view>
            <text class="guide-desc">{{item.description}}</text>
            <view class="guide-meta">
              <text class="guide-rating">â­ {{item.rating}}</text>
              <text class="guide-views">{{item.views}}æ¬¡æµè§ˆ</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- AIä¸ªæ€§åŒ–æ´»åŠ¨æ¨è -->
    <view class="ai-recommendation-section">
      <view class="section-header">
        <text class="section-title">AIä¸ªæ€§åŒ–æ´»åŠ¨æ¨è</text>
        <text class="section-subtitle">æ™ºèƒ½åŒ¹é…æœ€é€‚åˆä½ ä»¬çš„çº¦ä¼šæ´»åŠ¨</text>
      </view>
      <button class="generate-btn" bindtap="showActivityForm">
        <text class="btn-icon">ğŸ¯</text>
        <text class="btn-text">å¼€å§‹AIæ¨è</text>
      </button>
    </view>
  </view>



  <!-- ç”¨æˆ·ç”»åƒè¡¨å•å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showProfileForm}}" bindtap="hideProfileForm">
    <view class="modal-content profile-modal" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">å®Œå–„ç”¨æˆ·ä¿¡æ¯</text>
        <text class="modal-close" bindtap="hideProfileForm">Ã—</text>
      </view>
      
      <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
      <view class="step-indicator">
        <view class="step {{currentFormStep >= 1 ? 'active' : ''}}">åŸºæœ¬ä¿¡æ¯</view>
        <view class="step {{currentFormStep >= 2 ? 'active' : ''}}">æ€§æ ¼å…´è¶£</view>
        <view class="step {{currentFormStep >= 3 ? 'active' : ''}}">å…³ç³»ä¿¡æ¯</view>
      </view>
      
      <view class="modal-body">
        <!-- ç¬¬ä¸€æ­¥ï¼šåŸºæœ¬ä¿¡æ¯ -->
        <view class="form-step" wx:if="{{currentFormStep === 1}}">
          <view class="step-title">åŸºæœ¬ä¿¡æ¯</view>
          
          <!-- ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ -->
          <view class="form-section">
            <view class="section-header-with-avatar">
              <view class="avatar-container">
                <view class="avatar-icon">ğŸ‘¤</view>
              </view>
              <text class="section-title">æˆ‘çš„ä¿¡æ¯</text>
            </view>
            <view class="input-group">
              <input class="form-input" placeholder="å§“å" value="{{userProfile.name}}" bindinput="onUserBasicInfoInput" data-field="name" />
              <input class="form-input" placeholder="å¹´é¾„" value="{{userProfile.age}}" bindinput="onUserBasicInfoInput" data-field="age" />
              <picker class="form-picker" range="{{['å¥³', 'ç”·']}}" value="{{userProfile.gender === 'å¥³' ? 0 : userProfile.gender === 'ç”·' ? 1 : -1}}" bindchange="onUserPickerChange" data-field="gender">
                <view class="picker-text">{{userProfile.gender || 'é€‰æ‹©æ€§åˆ«'}}</view>
              </picker>
              <picker class="form-picker" range="{{regionData.provinces}}" value="{{regionData.provinces.indexOf(userProfile.province) >= 0 ? regionData.provinces.indexOf(userProfile.province) : 0}}" bindchange="onUserPickerChange" data-field="province">
                <view class="picker-text">{{userProfile.province || 'é€‰æ‹©çœä»½'}}</view>
              </picker>
              <picker class="form-picker" range="{{regionData.cities[userProfile.province] || []}}" value="{{regionData.cities[userProfile.province] && regionData.cities[userProfile.province].indexOf(userProfile.city) >= 0 ? regionData.cities[userProfile.province].indexOf(userProfile.city) : 0}}" bindchange="onUserPickerChange" data-field="city">
                <view class="picker-text">{{userProfile.city || 'é€‰æ‹©åŸå¸‚'}}</view>
              </picker>
              <picker class="form-picker" range="{{occupationOptions}}" value="{{occupationOptions.indexOf(userProfile.occupation)}}" bindchange="onUserPickerChange" data-field="occupation">
                <view class="picker-text">{{userProfile.occupation || 'é€‰æ‹©èŒä¸š'}}</view>
              </picker>
            </view>
          </view>
          
          <!-- ä¼´ä¾£åŸºæœ¬ä¿¡æ¯ -->
          <view class="form-section">
            <view class="section-header-with-avatar">
              <view class="avatar-container">
                <view class="avatar-icon">ğŸ’•</view>
              </view>
              <text class="section-title">ä¼´ä¾£ä¿¡æ¯</text>
            </view>
            <view class="input-group">
              <input class="form-input" placeholder="ä¼´ä¾£å§“å" value="{{partnerProfile.name}}" bindinput="onPartnerBasicInfoInput" data-field="name" />
              <input class="form-input" placeholder="ä¼´ä¾£å¹´é¾„" value="{{partnerProfile.age}}" bindinput="onPartnerBasicInfoInput" data-field="age" />
              <picker class="form-picker" range="{{['å¥³', 'ç”·']}}" value="{{partnerProfile.gender === 'å¥³' ? 0 : partnerProfile.gender === 'ç”·' ? 1 : -1}}" bindchange="onPartnerPickerChange" data-field="gender">
                <view class="picker-text">{{partnerProfile.gender || 'é€‰æ‹©æ€§åˆ«'}}</view>
              </picker>
              <picker class="form-picker" range="{{regionData.provinces}}" value="{{regionData.provinces.indexOf(partnerProfile.province) >= 0 ? regionData.provinces.indexOf(partnerProfile.province) : 0}}" bindchange="onPartnerPickerChange" data-field="province">
                <view class="picker-text">{{partnerProfile.province || 'é€‰æ‹©çœä»½'}}</view>
              </picker>
              <picker class="form-picker" range="{{regionData.cities[partnerProfile.province] || []}}" value="{{regionData.cities[partnerProfile.province] && regionData.cities[partnerProfile.province].indexOf(partnerProfile.city) >= 0 ? regionData.cities[partnerProfile.province].indexOf(partnerProfile.city) : 0}}" bindchange="onPartnerPickerChange" data-field="city">
                <view class="picker-text">{{partnerProfile.city || 'é€‰æ‹©åŸå¸‚'}}</view>
              </picker>
              <picker class="form-picker" range="{{occupationOptions}}" value="{{occupationOptions.indexOf(partnerProfile.occupation)}}" bindchange="onPartnerPickerChange" data-field="occupation">
                <view class="picker-text">{{partnerProfile.occupation || 'é€‰æ‹©èŒä¸š'}}</view>
              </picker>
            </view>
          </view>
        </view>
        
        <!-- ç¬¬äºŒæ­¥ï¼šæ€§æ ¼å…´è¶£ -->
        <view class="form-step" wx:if="{{currentFormStep === 2}}">
          <view class="step-title">æ€§æ ¼ä¸å…´è¶£</view>
          
          <!-- æ€§æ ¼ç‰¹å¾ -->
          <view class="form-section">
            <view class="section-header-with-avatar">
              <view class="avatar-container">
                <view class="avatar-icon">ğŸ­</view>
              </view>
              <text class="section-title">æ€§æ ¼ç‰¹å¾</text>
            </view>
            <view class="tag-group">
              <text class="tag-label">æˆ‘çš„æ€§æ ¼ï¼š</text>
              <view class="tag-list">
                <view class="tag {{userProfile.personality.includes(item) ? 'selected' : ''}}" 
                      wx:for="{{userProfile.personalityTags}}" 
                      wx:key="*this"
                      bindtap="onPersonalitySelect" 
                      data-type="user" 
                      data-value="{{item}}">{{item}}</view>
              </view>
            </view>
            <view class="tag-group">
              <text class="tag-label">ä¼´ä¾£æ€§æ ¼ï¼š</text>
              <view class="tag-list">
                <view class="tag {{partnerProfile.personality.includes(item) ? 'selected' : ''}}" 
                      wx:for="{{partnerProfile.personalityTags}}" 
                      wx:key="*this"
                      bindtap="onPersonalitySelect" 
                      data-type="partner" 
                      data-value="{{item}}">{{item}}</view>
              </view>
            </view>
          </view>
          
          <!-- å…´è¶£çˆ±å¥½ -->
          <view class="form-section">
            <view class="section-header-with-avatar">
              <view class="avatar-container">
                <view class="avatar-icon">ğŸ¨</view>
              </view>
              <text class="section-title">å…´è¶£çˆ±å¥½</text>
            </view>
            <view class="tag-group">
              <text class="tag-label">æˆ‘çš„å…´è¶£ï¼š</text>
              <view class="tag-list">
                <view class="tag {{userProfile.interests.includes(item) ? 'selected' : ''}}" 
                      wx:for="{{userProfile.interestOptions}}" 
                      wx:key="*this"
                      bindtap="onInterestSelect" 
                      data-type="user" 
                      data-value="{{item}}">{{item}}</view>
              </view>
            </view>
            <view class="tag-group">
              <text class="tag-label">ä¼´ä¾£å…´è¶£ï¼š</text>
              <view class="tag-list">
                <view class="tag {{partnerProfile.interests.includes(item) ? 'selected' : ''}}" 
                      wx:for="{{partnerProfile.interestOptions}}" 
                      wx:key="*this"
                      bindtap="onInterestSelect" 
                      data-type="partner" 
                      data-value="{{item}}">{{item}}</view>
              </view>
            </view>
          </view>
          
          <!-- ç”Ÿæ´»ä¹ æƒ¯ -->
          <view class="form-section">
            <view class="section-header-with-avatar">
              <view class="avatar-container">
                <view class="avatar-icon">ğŸŒ™</view>
              </view>
              <text class="section-title">ç”Ÿæ´»ä¹ æƒ¯</text>
            </view>
            <view class="tag-group">
              <text class="tag-label">æˆ‘çš„ä¹ æƒ¯ï¼š</text>
              <view class="tag-list">
                <view class="tag {{userProfile.lifestyle.includes(item) ? 'selected' : ''}}" 
                      wx:for="{{userProfile.lifestyleOptions}}" 
                      wx:key="*this"
                      bindtap="onLifestyleSelect" 
                      data-type="user" 
                      data-value="{{item}}">{{item}}</view>
              </view>
            </view>
            <view class="tag-group">
              <text class="tag-label">ä¼´ä¾£ä¹ æƒ¯ï¼š</text>
              <view class="tag-list">
                <view class="tag {{partnerProfile.lifestyle.includes(item) ? 'selected' : ''}}" 
                      wx:for="{{partnerProfile.lifestyleOptions}}" 
                      wx:key="*this"
                      bindtap="onLifestyleSelect" 
                      data-type="partner" 
                      data-value="{{item}}">{{item}}</view>
              </view>
            </view>
          </view>
        </view>
        
        <!-- ç¬¬ä¸‰æ­¥ï¼šå…³ç³»ä¿¡æ¯ -->
        <view class="form-step" wx:if="{{currentFormStep === 3}}">
          <view class="step-title">å…³ç³»ä¿¡æ¯</view>
          
          <!-- æ‹çˆ±çŠ¶æ€ -->
          <view class="form-section">
            <view class="section-header-with-avatar">
              <view class="avatar-container">
                <view class="avatar-icon">ğŸ’‘</view>
              </view>
              <text class="section-title">æ‹çˆ±çŠ¶æ€</text>
            </view>
            <picker class="form-picker" range="{{relationshipInfo.statusOptions}}" value="{{relationshipInfo.statusOptions.indexOf(relationshipInfo.relationshipStatus)}}" bindchange="onRelationshipPickerChange" data-field="relationshipStatus">
              <view class="picker-text">{{relationshipInfo.relationshipStatus || 'é€‰æ‹©æ‹çˆ±çŠ¶æ€'}}</view>
            </picker>
            <picker class="form-picker" range="{{relationshipInfo.durationOptions}}" value="{{relationshipInfo.durationOptions.indexOf(relationshipInfo.relationshipDuration)}}" bindchange="onRelationshipPickerChange" data-field="relationshipDuration">
              <view class="picker-text">{{relationshipInfo.relationshipDuration || 'é€‰æ‹©æ‹çˆ±æ—¶é•¿'}}</view>
            </picker>
            <picker class="form-picker" range="{{relationshipInfo.frequencyOptions}}" value="{{relationshipInfo.frequencyOptions.indexOf(relationshipInfo.meetingFrequency)}}" bindchange="onRelationshipPickerChange" data-field="meetingFrequency">
              <view class="picker-text">{{relationshipInfo.meetingFrequency || 'é€‰æ‹©è§é¢é¢‘ç‡'}}</view>
            </picker>
          </view>
          
          <!-- æ²Ÿé€šæ–¹å¼ -->
          <view class="form-section">
            <view class="section-header-with-avatar">
              <view class="avatar-container">
                <view class="avatar-icon">ğŸ’¬</view>
              </view>
              <text class="section-title">æ²Ÿé€šæ–¹å¼</text>
            </view>
            <view class="tag-group">
              <text class="tag-label">é€‰æ‹©æ²Ÿé€šæ–¹å¼ï¼š</text>
              <view class="tag-list">
                <view class="tag {{relationshipInfo.communicationMethods.includes(item) ? 'selected' : ''}}" 
                      wx:for="{{relationshipInfo.communicationOptions}}" 
                      wx:key="*this"
                      bindtap="onCommunicationSelect" 
                      data-value="{{item}}">{{item}}</view>
              </view>
            </view>
          </view>
          
          <!-- æ—¥å¸¸äº’åŠ¨ -->
          <view class="form-section">
            <view class="section-header-with-avatar">
              <view class="avatar-container">
                <view class="avatar-icon">ğŸ®</view>
              </view>
              <text class="section-title">æ—¥å¸¸äº’åŠ¨ä¹ æƒ¯</text>
            </view>
            <view class="tag-group">
              <text class="tag-label">é€‰æ‹©äº’åŠ¨æ–¹å¼ï¼š</text>
              <view class="tag-list">
                <view class="tag {{relationshipInfo.dailyInteractions.includes(item) ? 'selected' : ''}}" 
                      wx:for="{{relationshipInfo.interactionOptions}}" 
                      wx:key="*this"
                      bindtap="onInteractionSelect" 
                      data-value="{{item}}">{{item}}</view>
              </view>
            </view>
          </view>
        </view>
        

        
        <!-- è¡¨å•å¯¼èˆªæŒ‰é’® -->
        <view class="form-navigation">
          <button class="nav-btn secondary" wx:if="{{currentFormStep > 1}}" bindtap="prevStep">ä¸Šä¸€æ­¥</button>
          <button class="nav-btn primary" wx:if="{{currentFormStep < 3}}" bindtap="nextStep">ä¸‹ä¸€æ­¥</button>
          <button class="nav-btn primary" wx:if="{{currentFormStep === 3}}" bindtap="saveAllUserInfo">ä¿å­˜ä¿¡æ¯</button>
        </view>
      </view>
    </view>
  </view>

  <!-- ç¤¼ç‰©æ¨èè¡¨å•å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showGiftForm}}" bindtap="hideGiftForm">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">ç”Ÿæˆç¤¼ç‰©æ¨è</text>
        <text class="modal-close" bindtap="hideGiftForm">Ã—</text>
      </view>
      <view class="modal-body">
        <text class="form-tip">è®¾ç½®é¢„ç®—å’Œåœºåˆï¼ŒAIä¸ºæ‚¨æ¨èæœ€é€‚åˆçš„ç¤¼ç‰©</text>
        
        <!-- é¢„ç®—è¾“å…¥ -->
        <view class="form-group">
          <text class="form-label">é¢„ç®—ï¼ˆç§¯åˆ†ï¼‰</text>
          <input class="form-input" type="number" placeholder="è¯·è¾“å…¥é¢„ç®—ç§¯åˆ†" value="{{giftBudget}}" bindinput="onGiftBudgetInput" />
        </view>
        
        <!-- åœºåˆè¾“å…¥ -->
        <view class="form-group">
          <text class="form-label">åœºåˆ</text>
          <input class="form-input" placeholder="å¦‚ï¼šç”Ÿæ—¥ã€çºªå¿µæ—¥ã€é“æ­‰ç­‰" value="{{giftOccasion}}" bindinput="onGiftOccasionInput" />
        </view>
        
        <button class="save-btn" bindtap="generateGiftRecommendations" data-budget="{{giftBudget}}" data-occasion="{{giftOccasion}}">ç”Ÿæˆæ¨è</button>
      </view>
    </view>
  </view>

  <!-- æ´»åŠ¨æ¨èè¡¨å•å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showActivityForm}}" bindtap="hideActivityForm">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">ç”Ÿæˆæ´»åŠ¨æ¨è</text>
        <text class="modal-close" bindtap="hideActivityForm">Ã—</text>
      </view>
      <view class="modal-body">
        <text class="form-tip">é€‰æ‹©æ´»åŠ¨ç±»å‹å’Œé¢„ç®—ï¼ŒAIä¸ºæ‚¨æ¨èæœ€é€‚åˆçš„æ´»åŠ¨</text>
        <button class="save-btn" bindtap="generateActivityRecommendations">ç”Ÿæˆæ¨è</button>
      </view>
    </view>
  </view>

  <!-- å•†å“è¯¦æƒ…å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{selectedProduct}}" bindtap="hideProductDetail">
    <view class="modal-content product-modal" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">å•†å“è¯¦æƒ…</text>
        <text class="modal-close" bindtap="hideProductDetail">Ã—</text>
      </view>
      <view class="modal-body">
        <image class="product-image" style="  width: 10rpx;  height: 10rpx;" src="{{selectedProduct.image}}" mode="aspectFill"></image>
        <text class="product-name">{{selectedProduct.name}}</text>
        <view class="product-price">
                      <view class="product-points-display">
              <image class="product-points-icon" src="https://dis-1301530190.cos.ap-nanjing.myqcloud.com/LittlehomePic/rice/heart.png" mode="aspectFit"></image>
              <text class="product-current-points">{{selectedProduct.points}}</text>
            </view>
            <text class="product-original-points" wx:if="{{selectedProduct.originalPoints}}">{{selectedProduct.originalPoints}}</text>
        </view>
        <text class="product-category">åˆ†ç±»: {{selectedProduct.category}}</text>
        <view class="product-tags">
          <text class="product-tag" wx:for="{{selectedProduct.tags}}" wx:key="*this">{{item}}</text>
        </view>
        <button class="purchase-btn" bindtap="purchaseProduct">ç«‹å³è´­ä¹°</button>
      </view>
    </view>
  </view>

  <!-- æ”»ç•¥è¯¦æƒ…å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{selectedGuide}}" bindtap="hideGuideDetail">
    <view class="modal-content guide-modal" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">æ”»ç•¥è¯¦æƒ…</text>
        <text class="modal-close" bindtap="hideGuideDetail">Ã—</text>
      </view>
      <view class="modal-body">
        <image class="guide-detail-image" src="{{selectedGuide.image}}" mode="aspectFill"></image>
        <text class="guide-detail-title">{{selectedGuide.title}}</text>
        <text class="guide-detail-category">{{selectedGuide.category}}</text>
        <text class="guide-detail-desc">{{selectedGuide.description}}</text>
        <view class="guide-detail-meta">
          <text class="guide-detail-rating">â­ {{selectedGuide.rating}}</text>
          <text class="guide-detail-views">{{selectedGuide.views}}æ¬¡æµè§ˆ</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åˆ†äº«Canvasï¼ˆéšè—ï¼‰ -->
  <canvas canvas-id="shareCanvas" style="position: fixed; top: -1000px; left: -1000px; width: 300px; height: 400px;"></canvas>

  <!-- åº•éƒ¨åŠ è½½çŠ¶æ€ -->
  <view class="bottom-loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">AIæ­£åœ¨ä¸ºæ‚¨ç”Ÿæˆæ¨è...</text>
  </view>

  <!-- åº•éƒ¨ç¤¼ç‰©æ¨èåˆ—è¡¨ -->
  <view class="bottom-gift-list" wx:if="{{giftRecommendations.length > 0}}">
    <view class="list-header">
      <text class="list-title">ğŸ¯ AIä¸ºæ‚¨æ¨è</text>
      <text class="list-subtitle">åŸºäºé¢„ç®—: {{giftBudget}}ç§¯åˆ† | åœºåˆ: {{giftOccasion}}</text>
    </view>
    
    <view class="gift-item" wx:for="{{giftRecommendations}}" wx:key="id">
      <view class="gift-image">
        <image src="{{item.image}}" mode="aspectFill"></image>
      </view>
      <view class="gift-info">
        <text class="gift-name">{{item.name}}</text>
        <text class="gift-reason">{{item.reason}}</text>
        <view class="gift-meta">
          <view class="price-info">
            <view class="points-display">
              <image class="points-icon" src="https://dis-1301530190.cos.ap-nanjing.myqcloud.com/LittlehomePic/rice/heart.png" mode="aspectFit"></image>
              <text class="current-points">{{item.points}}</text>
            </view>
            <text class="original-points" wx:if="{{item.originalPoints}}">{{item.originalPoints}}</text>
          </view>
          <view class="rating-info">
            <text class="rating">â­ {{item.rating}}</text>
            <text class="sales">å·²å”®{{item.sales}}</text>
          </view>
        </view>
        <view class="gift-actions">
          <button class="action-btn primary" bindtap="selectProduct" data-id="{{item.id}}">åŠ å…¥è´­ç‰©è½¦</button>
          <button class="action-btn secondary" bindtap="shareRecommendation" data-type="gift" data-id="{{item.id}}">åˆ†äº«</button>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ´»åŠ¨æ¨èåˆ—è¡¨ -->
  <view class="bottom-activity-list" wx:if="{{activityRecommendations.length > 0}}">
    <view class="list-header">
      <text class="list-title">ğŸ¯ AIä¸ºæ‚¨æ¨è</text>
      <text class="list-subtitle">åŸºäºé¢„ç®—: {{activityBudget}}ç§¯åˆ† | ç±»å‹: {{activityType}}</text>
    </view>
    
    <view class="activity-item" wx:for="{{activityRecommendations}}" wx:key="id">
      <view class="activity-image">
        <image src="{{item.image}}" mode="aspectFill"></image>
        <view class="activity-type-badge">{{item.type === 'online' ? 'çº¿ä¸Š' : item.type === 'local' ? 'æœ¬åœ°' : 'æ··åˆ'}}</view>
      </view>
      <view class="activity-info">
        <text class="activity-name">{{item.name}}</text>
        <text class="activity-desc">{{item.description}}</text>
        <view class="activity-meta">
          <view class="duration-info">
            <text class="duration">â±ï¸ {{item.duration}}</text>
            <view class="activity-points-display">
              <image class="activity-points-icon" src="https://dis-1301530190.cos.ap-nanjing.myqcloud.com/LittlehomePic/rice/heart.png" mode="aspectFit"></image>
              <text class="activity-points">{{item.points}}</text>
            </view>
          </view>
          <view class="rating-info">
            <text class="rating">â­ {{item.rating}}</text>
            <text class="participants">{{item.participants}}äººå‚ä¸</text>
          </view>
        </view>
        <view class="activity-tags">
          <text class="activity-tag" wx:for="{{item.tags}}" wx:key="*this">{{item}}</text>
        </view>
        <view class="activity-actions">
          <button class="action-btn primary" bindtap="bookActivity" data-id="{{item.id}}">ç«‹å³é¢„è®¢</button>
          <button class="action-btn secondary" bindtap="shareRecommendation" data-type="activity" data-id="{{item.id}}">åˆ†äº«</button>
        </view>
      </view>
    </view>
  </view>
</view> 