image.png<view class="custom-navbar">
  <text class="navbar-title">LittleHome</text>
</view>

<view class="butler-container page-container" style="margin-top: 100px;">
  <!-- 用户信息栏 -->
  <view class="user-info-bar">
    <image class="user-avatar-large" src="{{userInfo.avatarUrl}}" bindtap="editUserInfo"></image>
    <text class="user-nickname-large">{{userInfo.nickName}}</text>
    <view class="points-large">
      <image class="heart-icon-large" src="https://dis-1301530190.cos.ap-nanjing.myqcloud.com/LittlehomePic/rice/heart.png" mode="aspectFit"></image>
      <text>{{points}}</text>
    </view>
  </view>
  
  <!-- 第一栏：每日相关 -->
  <view class="section">
    <view class="section-title" bindtap="goToDailyRecord">每日记录</view>
    <view class="grid-container">
      <view class="grid-item" bindtap="clockIn" disabled="{{hasClockIn}}">
        <image src="https://dis-1301530190.cos.ap-nanjing.myqcloud.com/LittlehomePic/clockon.png" mode="aspectFit"/>
        <text>{{hasClockIn ? '已打卡' : '打卡'}}</text>
      </view>
      <view class="grid-item" bindtap="showMoodPicker">
        <image src="{{selectedMood || 'https://dis-1301530190.cos.ap-nanjing.myqcloud.com/LittlehomePic/emotion/emotion1.png'}}" mode="aspectFit"/>
        <text>今日心情</text>
      </view>
      <view class="grid-item" bindtap="goToAnniversary">
        <image src="https://dis-1301530190.cos.ap-nanjing.myqcloud.com/LittlehomePic/anniversary.png" mode="aspectFit"/>
        <text>纪念日</text>
      </view>
    </view>
  </view>
  
  <!-- 第三栏：纪念品 -->
  <view class="section">
    <view class="section-title" bindtap="goToSouvenirs">
      <text>纪念品</text>
      <text class="section-subtitle">定制专属纪念品 ></text>
    </view>
    <view class="souvenirs-preview">
      <view class="souvenir-card" bindtap="goToSouvenirs">
        <view class="souvenir-icon">🎁</view>
        <view class="souvenir-info">
          <text class="souvenir-title">定制化情侣纪念品</text>
          <text class="souvenir-desc">将美好回忆转化为实体纪念品</text>
        </view>
        <view class="souvenir-arrow">></view>
      </view>
    </view>
  </view>

  <!-- 心情选择器弹出层 -->
  <view class="mood-picker {{showMoodPicker ? 'show' : ''}}">
    <view class="mood-mask" bindtap="hideMoodPicker"></view>
    <view class="mood-content">
      <view class="mood-title">选择心情</view>
      <view class="mood-grid">
        <view class="mood-item" wx:for="{{15}}" wx:key="index" bindtap="selectMood" data-index="{{index + 1}}">
          <image src="https://dis-1301530190.cos.ap-nanjing.myqcloud.com/LittlehomePic/emotion/emotion{{index + 1}}.png" mode="aspectFit"/>
        </view>
      </view>
    </view>
  </view>

  <!-- 骰子结果弹出层 -->
  <view class="dice-result {{showDiceResult ? 'show' : ''}}">
    <view class="dice-mask" bindtap="hideDiceResult"></view>
    <view class="dice-content">
      <view class="dice-number">点数为{{diceNumber}}</view>
      <view class="dice-text">{{diceResult}}</view>
    </view>
  </view>

  <!-- 注册弹窗 -->
  <view wx:if="{{showRegisterModal}}" class="register-modal">
    <view class="register-mask" bindtap="hideRegisterModal"></view>
    <view class="register-content">
      <view class="register-title">注册</view>
      <button class="avatar-wrapper" open-type="chooseAvatar" bind:chooseavatar="onRegisterAvatarChoose">
        <image class="avatar" src="{{registerAvatarUrl || 'https://dis-1301530190.cos.ap-nanjing.myqcloud.com/LittlehomePic/profile.jpg'}}"></image>
        <text>选择头像</text>
      </button>
      <input type="nickname" class="register-nickname" placeholder="请输入昵称" bindinput="onRegisterNickNameInput" value="{{registerNickName}}" />
      <button class="register-btn" bindtap="onRegisterUser">提交注册</button>
      <text style="font-size:12px;color:#888;word-break:break-all;">{{registerAvatarUrl}}</text>
    </view>
  </view>

  <!-- 用户信息编辑弹窗 -->
  <view wx:if="{{showEditUserModal}}" class="edit-user-modal">
    <view class="edit-user-mask" bindtap="hideEditUserModal"></view>
    <view class="edit-user-content">
      <view class="edit-user-header">
        <text class="edit-user-title">编辑个人信息</text>
        <text class="edit-user-close" bindtap="hideEditUserModal">×</text>
      </view>
      <view class="edit-user-body">
        <view class="avatar-section">
          <text class="avatar-label">更换头像</text>
          <button class="avatar-wrapper" open-type="chooseAvatar" bind:chooseavatar="onEditAvatarChoose">
            <image class="avatar" src="{{editAvatarUrl || userInfo.avatarUrl || 'https://dis-1301530190.cos.ap-nanjing.myqcloud.com/LittlehomePic/profile.jpg'}}"></image>
          </button>
        </view>
        <view class="nickname-section">
          <text class="nickname-label">昵称</text>
          <input type="nickname" class="nickname-input" placeholder="请输入昵称" bindinput="onEditNickNameInput" value="{{editNickName}}" />
        </view>
        <view class="gender-section">
          <text class="gender-label">性别</text>
          <radio-group class="gender-group" bindchange="onEditGenderChange" value="{{editGender}}">
            <label class="gender-option"><radio value="male" checked="{{editGender==='male'}}"/>男</label>
            <label class="gender-option"><radio value="female" checked="{{editGender==='female'}}"/>女</label>
            <label class="gender-option"><radio value="unknown" checked="{{editGender==='unknown'}}"/>保密</label>
          </radio-group>
        </view>
        <view class="edit-actions">
          <button class="edit-btn cancel" bindtap="hideEditUserModal">取消</button>
          <button class="edit-btn confirm" bindtap="onEditUserSave">保存</button>
        </view>
      </view>
    </view>
  </view>

  <!-- 隐私保护区域 -->
  <view class="section">
    <view class="section-title">隐私保护</view>
    <view class="privacy-grid">
      <view class="privacy-item" bindtap="showPrivacySettings">
        <view class="privacy-icon">🔒</view>
        <text class="privacy-title">隐私设置</text>
        <text class="privacy-desc">管理数据权限</text>
      </view>
      <view class="privacy-item" bindtap="showDataExport">
        <view class="privacy-icon">📤</view>
        <text class="privacy-title">数据导出</text>
        <text class="privacy-desc">导出个人数据</text>
      </view>
      <view class="privacy-item" bindtap="showDataDelete">
        <view class="privacy-icon">🗑️</view>
        <text class="privacy-title">数据删除</text>
        <text class="privacy-desc">清除所有数据</text>
      </view>
      <view class="privacy-item" bindtap="showPrivacyPolicy">
        <view class="privacy-icon">📋</view>
        <text class="privacy-title">隐私政策</text>
        <text class="privacy-desc">查看详细说明</text>
      </view>
    </view>
  </view>

  <!-- 隐私设置弹窗 -->
  <view wx:if="{{showPrivacySettingsModal}}" class="privacy-modal">
    <view class="privacy-mask" bindtap="hidePrivacySettingsModal"></view>
    <view class="privacy-content">
      <view class="privacy-header">
        <text class="privacy-header-title">隐私设置</text>
        <button class="privacy-close" bindtap="hidePrivacySettingsModal">×</button>
      </view>
      
      <scroll-view class="privacy-body" scroll-y="true">
        <!-- 数据控制设置 -->
        <view class="privacy-section">
          <text class="section-title">数据控制</text>
          
          <view class="privacy-item-setting">
            <view class="privacy-item-header">
              <view class="privacy-item-title-row">
                <text class="privacy-item-icon">🤖</text>
                <text class="privacy-item-title">情感分析数据</text>
              </view>
              <text class="privacy-item-desc">控制AI情感分析功能的数据使用</text>
            </view>
            <view class="privacy-item-controls">
              <switch checked="{{privacySettings.emotionAnalysis}}" bindchange="toggleEmotionAnalysis" color="#E6A4B4"></switch>
              <text class="privacy-item-status">{{privacySettings.emotionAnalysis ? '已启用' : '已禁用'}}</text>
            </view>
          </view>

          <view class="privacy-sub-item" wx:if="{{privacySettings.emotionAnalysis}}">
            <view class="privacy-item-header">
              <view class="privacy-item-title-row">
                <text class="privacy-item-icon">💬</text>
                <text class="privacy-item-title">文本消息情感分析</text>
              </view>
              <text class="privacy-item-desc">允许AI分析你们的文本消息中的情感倾向</text>
            </view>
            <view class="privacy-item-controls">
              <switch checked="{{privacySettings.textEmotionAnalysis}}" bindchange="toggleTextEmotionAnalysis" color="#E6A4B4"></switch>
              <text class="privacy-item-status">{{privacySettings.textEmotionAnalysis ? '已启用' : '已禁用'}}</text>
            </view>
          </view>

          <view class="privacy-sub-item" wx:if="{{privacySettings.emotionAnalysis}}">
            <view class="privacy-item-header">
              <view class="privacy-item-title-row">
                <text class="privacy-item-icon">🎤</text>
                <text class="privacy-item-title">语音消息情感分析</text>
              </view>
              <text class="privacy-item-desc">允许AI分析你们的语音消息中的情感倾向</text>
            </view>
            <view class="privacy-item-controls">
              <switch checked="{{privacySettings.voiceEmotionAnalysis}}" bindchange="toggleVoiceEmotionAnalysis" color="#E6A4B4"></switch>
              <text class="privacy-item-status">{{privacySettings.voiceEmotionAnalysis ? '已启用' : '已禁用'}}</text>
            </view>
          </view>

          <view class="privacy-sub-item" wx:if="{{privacySettings.emotionAnalysis}}">
            <view class="privacy-item-header">
              <view class="privacy-item-title-row">
                <text class="privacy-item-icon">📷</text>
                <text class="privacy-item-title">照片、视频消息情感分析</text>
              </view>
              <text class="privacy-item-desc">允许AI分析你们的照片、视频消息中的情感倾向</text>
            </view>
            <view class="privacy-item-controls">
              <switch checked="{{privacySettings.mediaEmotionAnalysis}}" bindchange="toggleMediaEmotionAnalysis" color="#E6A4B4"></switch>
              <text class="privacy-item-status">{{privacySettings.mediaEmotionAnalysis ? '已启用' : '已禁用'}}</text>
            </view>
          </view>

          <view class="privacy-item-setting">
            <view class="privacy-item-header">
              <view class="privacy-item-title-row">
                <text class="privacy-item-icon">💬</text>
                <text class="privacy-item-title">对话记录存储</text>
              </view>
              <text class="privacy-item-desc">是否在本地保存对话历史记录</text>
            </view>
            <view class="privacy-item-controls">
              <switch checked="{{privacySettings.conversationStorage}}" bindchange="toggleConversationStorage" color="#E6A4B4"></switch>
              <text class="privacy-item-status">{{privacySettings.conversationStorage ? '已启用' : '已禁用'}}</text>
            </view>
          </view>

          <view class="privacy-item-setting">
            <view class="privacy-item-header">
              <view class="privacy-item-title-row">
                <text class="privacy-item-icon">📷</text>
                <text class="privacy-item-title">照片和媒体</text>
              </view>
              <text class="privacy-item-desc">控制照片和媒体文件的存储权限</text>
            </view>
            <view class="privacy-item-controls">
              <switch checked="{{privacySettings.mediaStorage}}" bindchange="toggleMediaStorage" color="#E6A4B4"></switch>
              <text class="privacy-item-status">{{privacySettings.mediaStorage ? '已启用' : '已禁用'}}</text>
            </view>
          </view>

          <view class="privacy-item-setting">
            <view class="privacy-item-header">
              <view class="privacy-item-title-row">
                <text class="privacy-item-icon">📍</text>
                <text class="privacy-item-title">位置信息</text>
              </view>
              <text class="privacy-item-desc">控制位置信息的收集和使用</text>
            </view>
            <view class="privacy-item-controls">
              <switch checked="{{privacySettings.locationTracking}}" bindchange="toggleLocationTracking" color="#E6A4B4"></switch>
              <text class="privacy-item-status">{{privacySettings.locationTracking ? '已启用' : '已禁用'}}</text>
            </view>
          </view>
        </view>

        <!-- 访问控制设置 -->
        <view class="privacy-section">
          <text class="section-title">访问控制</text>
          
          <view class="privacy-item-setting">
            <view class="privacy-item-header">
              <view class="privacy-item-title-row">
                <text class="privacy-item-icon">⏰</text>
                <text class="privacy-item-title">隐私时间设置</text>
              </view>
              <text class="privacy-item-desc">设置不被打扰的私人时间段</text>
            </view>
            <view class="privacy-item-controls">
              <switch checked="{{privacySettings.privacyTime}}" bindchange="togglePrivacyTime" color="#E6A4B4"></switch>
              <text class="privacy-item-status">{{privacySettings.privacyTime ? '已启用' : '已禁用'}}</text>
            </view>
          </view>

          <view class="privacy-item-setting">
            <view class="privacy-item-header">
              <view class="privacy-item-title-row">
                <text class="privacy-item-icon">🔥</text>
                <text class="privacy-item-title">阅后即焚</text>
              </view>
              <text class="privacy-item-desc">为共享内容设置过期时间，自动消失保护隐私</text>
            </view>
            <view class="privacy-item-controls">
              <switch checked="{{privacySettings.burnAfterRead}}" bindchange="toggleBurnAfterRead" color="#E6A4B4"></switch>
              <text class="privacy-item-status">{{privacySettings.burnAfterRead ? '已启用' : '已禁用'}}</text>
            </view>
          </view>
        </view>

        <!-- 隐私政策 -->
        <view class="privacy-section">
          <text class="section-title">隐私政策</text>
          <view class="privacy-policy-content">
            <text class="policy-text">
              • 所有数据采用端到端加密存储和传输
              • 不会在云端存储您的原始对话内容
              • AI仅作为情感助手，不会评判您的关系
              • 支持文本、语音、照片视频的精准情感分析
              • 不会向第三方分享您的个人信息
              • 您可以随时删除所有数据
              • 支持数据导出和本地备份
              • 提供应用锁定和私人时间保护
              • 阅后即焚功能确保敏感内容自动过期删除
            </text>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- 登录/退出登录区域 -->
  <view class="section">
    <view class="section-title">账户管理</view>
    <view class="login-grid">
      <view class="login-item" wx:if="{{!isLoggedIn}}" bindtap="showLoginModal">
        <view class="login-icon">👤</view>
        <text class="login-title">登录</text>
        <text class="login-desc">获取头像和昵称</text>
      </view>
      <view class="login-item" wx:if="{{isLoggedIn}}" bindtap="logout">
        <view class="login-icon">🚪</view>
        <text class="login-title">退出登录</text>
        <text class="login-desc">清除登录状态</text>
      </view>
    </view>
  </view>

  <!-- 登录弹窗 -->
  <view wx:if="{{showLoginModal}}" class="login-modal">
    <view class="login-mask" bindtap="hideLoginModal"></view>
    <view class="login-content">
      <view class="login-header">
        <text class="login-header-title">完善个人信息</text>
        <text class="login-close" bindtap="hideLoginModal">×</text>
      </view>
      <view class="login-body">
        <view class="avatar-section">
          <text class="avatar-label">选择头像</text>
          <button class="avatar-wrapper" open-type="chooseAvatar" bind:chooseavatar="onChooseAvatar">
            <image class="avatar" src="{{tempAvatarUrl || 'https://dis-1301530190.cos.ap-nanjing.myqcloud.com/LittlehomePic/profile.jpg'}}"></image>
          </button>
        </view>
        <view class="nickname-section">
          <text class="nickname-label">输入昵称</text>
          <input type="nickname" class="nickname-input" placeholder="请输入昵称" bindinput="onNickNameInput" value="{{tempNickName}}" />
        </view>
        <view class="login-actions">
          <button class="login-btn cancel" bindtap="hideLoginModal">取消</button>
          <button class="login-btn confirm" bindtap="confirmLogin">确认登录</button>
        </view>
      </view>
    </view>
  </view>

  <!-- 分享Canvas（隐藏） -->
  <canvas canvas-id="shareCanvas" style="position: fixed; top: -1000px; left: -1000px; width: 300px; height: 400px;"></canvas>
</view>